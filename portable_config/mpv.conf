################################################################################
#                            MPV CONFIGURATION FILE                           #
################################################################################
# Lines starting with "#" are disabled options (comments)
# Documentation: https://github.com/hooke007/mpv_PlayKit/blob/main/portable_config/mpv.conf
# Official MPV Manual: https://mpv.io/manual/stable/
# Note: --volume and --glsl-shaders are tracked globally in saved-props.json
#       Delete saved-props.json to reset these tracked properties
################################################################################

################################################################################
# CORE CONFIGURATION FILES                                                     #
################################################################################

# Custom input key bindings (uosc variant)
input-conf = "~~/input_uosc.conf"

# Include additional profile configurations
include = "~~/profiles.conf"

# Include script-specific options
include = "~~/script-opts.conf"

# Allow per-directory configuration files (mpv.conf in video folder)
use-filedir-conf = yes

# Uncomment to enable logging to desktop (useful for troubleshooting)
#log-file = "~~desktop/mpv-lazy.log"

################################################################################
# VIDEO OUTPUT & HARDWARE ACCELERATION                                         #
################################################################################

## Video Output Driver
# Use gpu-next (modern, GPU-accelerated renderer with advanced features)
vo = gpu-next

## GPU Context (Uncomment one if needed)
# Use Vulkan on Windows (better performance on some systems)
#gpu-context = winvk

## Direct3D 11 Options (for d3d11 context only)
# Enable exclusive fullscreen mode (may reduce input lag)
d3d11-exclusive-fs = yes
# Disable flip model presentation (use legacy blit model)
#d3d11-flip = no

## Hardware Decoding
# Use hardware decoding with fallback to software copy (safer than auto, needed for rife)
hwdec = auto-copy

# Limit hardware decoding to these codecs (prevents issues with rare formats)
hwdec-codecs = h264,hevc,vp8,vp9,av1,ffv1

## GPU Device Selection (Uncomment and modify for multi-GPU systems)
# Specify GPU for Direct3D 11
#d3d11-adapter = "NVIDIA GeForce RTX 2070 Super"
# Specify GPU for Vulkan
#vulkan-device = "NVIDIA GeForce RTX 2070 Super"

################################################################################
# PLAYBACK BEHAVIOR                                                            #
################################################################################

## Window & Control Behavior
# Keep window open when playback finishes (prevents auto-close)
idle = yes

# Disable IME input (prevents accidental character input during playback)
input-ime = no

# Disable built-in key bindings (using custom input.conf instead)
input-builtin-bindings = no

# Uncomment to enable IPC server (for external control)
#input-ipc-server = mpvpipe

# Uncomment to start playback paused by default
#pause = yes

## Seeking Behavior
# Don't drop frames during high-precision seeking (better accuracy)
hr-seek-framedrop = no

## Position Memory
# Save playback position on quit (resume from where you left off)
save-position-on-quit = yes

# Only save: position, video track, audio track, subtitle track
watch-later-options = start,vid,aid,sid

# Directory for watch-later state files
watch-later-dir = "~~/_cache/watch_later"

################################################################################
# PLAYLIST & FILE HANDLING                                                     #
################################################################################

## Playlist Behavior
# Uncomment to auto-create playlist from files with same extension
#autocreate-playlist = same

# Don't enter directory (treat single file as single item)
directory-mode = ignore

# Uncomment to filter directory by media types
#directory-filter-types = video,audio

## File Extension Filters (Uncomment to explicitly define)
#video-exts = avi,flv,m2ts,mkv,mov,mp4,ts,wmv
#image-exts = avif,bmp,jpeg,jpg,jxl,png,webp
#audio-exts = aiff,ape,flac,mp3,ogg,opus,wav

################################################################################
# WINDOW MANAGEMENT & DISPLAY                                                  #
################################################################################

## Window Behavior
# Keep window on top of other windows
ontop = yes

# Uncomment to hide title bar (borderless window)
#title-bar = no

# Minimum window size (50% of screen width/height)
autofit-smaller = 50%x50%

# Maximum window size (100% of screen, prevents upscaling beyond native resolution)
autofit-larger = 100%

# Maintain video aspect ratio within window
keepaspect-window = yes

# Disable automatic window resizing when video changes
auto-window-resize = no

# Disable HiDPI scaling (prevents blurry UI on high-DPI displays)
hidpi-window-scale = no

# Start in fullscreen mode
fullscreen = yes

# Prevent black bars by adding padding (0 = no padding, maintains aspect ratio)
panscan = 0

################################################################################
# COLOR MANAGEMENT                                                             #
################################################################################

## Color Space Handling
# Disable color space hinting to display (use display's native color space)
target-colorspace-hint = no

# Uncomment to enable color space hinting with specific mode
#target-colorspace-hint-mode = source
#target-colorspace-hint-strict = no

## ICC Profile
# Uncomment to enable automatic ICC profile loading from display
#icc-profile-auto = yes

# Cache directory for ICC profiles
icc-cache-dir = "~~/_cache/icc"

# Uncomment to disable ICC cache (forces re-computation)
#icc-cache = no

## Color Space Override (Advanced - uncomment to force specific color space)
# Force Display P3 color primaries
#target-prim = display-p3
# Force gamma 2.2 transfer function
#target-trc = gamma2.2

################################################################################
# CACHE & BUFFERING                                                            #
################################################################################

## Demuxer Cache Settings
# Maximum forward buffer size (2GB - larger values better for streaming)
demuxer-max-bytes = 2048MiB

# Maximum backward buffer size (512MB - for rewinding)
demuxer-max-back-bytes = 512MiB

# Read-ahead time in seconds (5 minutes of buffering)
demuxer-readahead-secs = 300

# Pause playback when initially buffering
cache-pause-initial = yes

# Wait 10 seconds before resuming after rebuffering
cache-pause-wait = 10

## Shader Cache
# Cache compiled GPU shaders (speeds up startup with complex shaders)
gpu-shader-cache-dir = "~~/_cache/shader"

# Uncomment to disable shader cache
#gpu-shader-cache = no

################################################################################
# ON-SCREEN DISPLAY (OSD)                                                      #
################################################################################

## OSD Behavior
# Show message (not progressbar) when seeking
osd-on-seek = msg

# Duration OSD messages stay visible (milliseconds)
osd-duration = 2000

# Duration for "now playing" message (milliseconds)
osd-playing-msg-duration = 3000

# Display filename when file starts playing
osd-playing-msg = "${filename}"

## OSD Appearance
# Uncomment to enable OSD blur (softer appearance)
#osd-blur = 1

# Progress bar width (100 = full width)
osd-bar-w = 100

# Progress bar height (1.5 = thickness)
osd-bar-h = 1.5

# Progress bar vertical alignment (-1 = bottom)
osd-bar-align-y = -1

# OSD text color (purple: #672168)
osd-color = "#672168"

# OSD border/outline color (white)
osd-border-color = "#FFFFFF"

# OSD text border thickness
osd-border-size = 1

# OSD font size in points
osd-font-size = 40

# Show fractions in timestamps (e.g., 1:23.456)
osd-fractions = yes

################################################################################
# AUDIO CONFIGURATION                                                          #
################################################################################

## Audio Output
# Use WASAPI audio output (Windows Audio Session API - low latency)
ao = wasapi

# Uncomment to specify exact audio device (find ID with --audio-device=help)
#audio-device = "wasapi/{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}"

# Uncomment for exclusive mode (bypasses Windows mixer, lower latency)
#audio-exclusive = yes

## Audio Settings
# Default volume (100 = 100%, tracked globally in script-opts.conf)
volume = 50

# Maximum volume limit (130 = 130%)
volume-max = 130

# Force stereo output (prevents upmixing)
audio-channels = stereo

## Audio Track Selection
# Preferred audio languages (priority order: English, Russian)
alang = eng,en,rus,ru

# Auto-load external audio files with fuzzy matching
audio-file-auto = fuzzy

################################################################################
# VIDEO PROCESSING                                                             #
################################################################################

## Frame Timing (Uncomment for motion interpolation)
# Sync video playback to display refresh rate and resample
video-sync = audio
# Allow up to 5% video speed change for sync
video-sync-max-video-change = 5
# Enable frame interpolation (smoother motion)
#interpolation = yes
# Temporal scaling algorithm (oversample = simple, fast)
#tscale = oversample

## Scaling Algorithms
# Chroma upscaling (spline36 = good quality/performance balance)
cscale = spline36

# Luma upscaling (spline36 = sharp, artifact-free)
scale = spline36

# Downscaling (spline36 = prevents aliasing when downsampling)
dscale = spline36

# Disable sigmoid upscaling (reduces ringing, but may soften image)
sigmoid-upscaling = no

# Disable correct downscaling (trade quality for performance)
correct-downscaling = no

## Image Enhancement
# Disable dithering (prevents noise on high-quality displays)
dither-depth = no

# Uncomment to enable debanding (reduces color banding artifacts)
#deband = yes

# Auto-deinterlace interlaced content
deinterlace = auto

## Checkerboard Background (for transparent/smaller videos)
# Light gray checkerboard color 1
background-tile-color-0 = "#B4B4B4"
# Lighter gray checkerboard color 2
background-tile-color-1 = "#DCDCDC"
# Checkerboard tile size in pixels
background-tile-size = 128

################################################################################
# SUBTITLES                                                                    #
################################################################################

## Subtitle File Loading
# Auto-load external subtitle files with fuzzy matching
sub-auto = fuzzy

# Search these subdirectories for subtitle files
sub-file-paths = sub;Subs;subtitles

# Character encoding for non-UTF8 subtitles (GB18030 for Chinese)
sub-codepage = GB18030

## Subtitle Track Selection
# Preferred subtitle languages (priority: English, Russian)
slang = eng,en,rus,ru

# Show subtitles even if audio language matches
subs-fallback = yes

## Subtitle Rendering
# Uncomment to blend subtitles into video (better color accuracy)
#blend-subtitles = yes

# HDR peak brightness for subtitle tone-mapping (100 nits)
sub-hdr-peak = 100

## Text Subtitle Styling
# Font family (LXGW WenKai Mono = Chinese-friendly monospace)
sub-font = "LXGW WenKai Mono"

# Font size in points
sub-font-size = 44

# Uncomment to prevent subtitle scaling with window size
#sub-scale-with-window = no

# Scale signs/translations to match video resolution
sub-scale-signs = yes

# Outline thickness for better readability
sub-outline-size = 4

# Slight blur to soften edges
sub-blur = 1

# Subtitle text color (yellow: #FFD766)
sub-color = "#FFD766"

# Uncomment for semi-transparent background box
#sub-back-color = "#641C1C1C"

# Uncomment to add drop shadow
#sub-shadow-offset = 2

# Allow subtitles in black bars (don't constrain to video area)
sub-use-margins = yes

## ASS/SSA Subtitle Options
# Uncomment to use video aspect ratio for ASS rendering
#sub-ass-use-video-data = aspect-ratio
#sub-ass-video-aspect-override = 16:9

# Uncomment to override ASS styles with settings above
#sub-ass-override = force
#sub-ass-scale-with-window = yes

# Disable VSFilter blur compatibility (more accurate rendering)
sub-ass-vsfilter-blur-compat = no

# Force ASS subtitles to use margins
sub-ass-force-margins = yes

# Uncomment to override ASS font
#sub-ass-style-overrides = Fontname=LXGW WenKai Mono

## Image-Based Subtitles (PGS/VobSub)
# HDR peak for image subtitle tone-mapping (10000 nits = preserve HDR)
image-subs-hdr-peak = 10000

# Uncomment to stretch PGS subtitles to screen width
#stretch-image-subs-to-screen = yes

# Uncomment to render image subs at video resolution (sharper)
#image-subs-video-resolution = yes

################################################################################
# SCREENSHOT SETTINGS                                                          #
################################################################################

## Screenshot Format
# Use PNG format (lossless, good compression)
screenshot-format = png

## Format-Specific Quality Settings
# JPEG quality (100 = maximum, only used if format changed to jpg)
screenshot-jpeg-quality = 100
# Uncomment to use source chroma subsampling for JPEG
#screenshot-jpeg-source-chroma = no

# PNG compression level (4 = balanced speed/size)
screenshot-png-compression = 4

# WebP lossless mode (enabled)
screenshot-webp-lossless = yes
# WebP quality for lossy mode (100 = maximum)
#screenshot-webp-quality = 100
# WebP compression effort (0 = fastest)
#screenshot-webp-compression = 0

# JPEG XL distance (0 = lossless)
screenshot-jxl-distance = 0

## Screenshot Metadata & Location
# Don't tag screenshots with color space info
screenshot-tag-colorspace = no

# Don't use high bit depth (16-bit PNG) even if video is HDR
screenshot-high-bit-depth = no

# Screenshot filename template (desktop/MPV-<filename>-N<number>)
screenshot-template = "~~desktop/MPV-%P-N%n"

################################################################################
# SCRIPTS, FILTERS, AND SHADERS                                                #
################################################################################

## Built-in Scripts
# Disable built-in stats overlay (using custom script instead)
#load-stats-overlay = no

# Disable built-in OSC (using uosc instead)
osc = no

# Uncomment to disable all scripts (for troubleshooting)
#load-scripts = no

## yt-dlp Options (for streaming from YouTube, etc.)
# Extract cookies from Edge browser (for age-restricted content)
#ytdl-raw-options-append = cookies-from-browser=edge

# Exclude danmaku subtitles (Chinese bullet comments)
ytdl-raw-options-append = sub-langs=-danmaku

## Window Blur Effect (for transparent/floating window)
# Uncomment to blur window background (Windows 11)
#border-background = blur

# Blur radius in pixels (8 = moderate blur)
background-blur-radius = 8

## Custom Shaders (Uncomment to load GLSL shaders)
# Example: Load QCOM SGEDS shader for upscaling
#glsl-shaders-append = "~~/shaders/QCOM/QCOM_SGEDS_ms_RT.glsl"
# Set shader-specific options (strength = 2.0)
#glsl-shader-opts-append = QCOM_SGEDS_ms_RT/STR=2.0

################################################################################
# DISPLAY SYNCHRONIZATION (G-Sync/FreeSync)                                    #
################################################################################

## Swap Interval Settings
# OpenGL swap interval (1 = vsync on, 0 = vsync off)
opengl-swapinterval = 0

# Direct3D 11 sync interval (1 = vsync on, 0 = vsync off)
d3d11-sync-interval = 0

# Vulkan presentation mode (immediate = no vsync, best for VRR displays)
vulkan-swap-mode = immediate

################################################################################
# DEBUG OPTIONS (Disable in production!)                                       #
################################################################################

## Logging
# Write detailed debug log to file (WARNING: Large file size, slow performance)
log-file = "~~/../mpv-debug.log"

# Log all messages at debug level (very verbose)
msg-level = all=debug

# NOTE: Comment out or remove the debug section above for normal usage!
# Uncomment only when troubleshooting issues.
